### 服务雪崩

多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和微服务C又调用其他的微服务，这就是所谓的“扇出”，如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统雪崩，所谓的“雪崩效应”。

对于高流量的应用来说，单一的后端依赖可能导致所有服务器上的所有资源都在几秒中内饱和。比失败更糟糕的是，这些应用程序还可能导致服务器之间的延迟增加、备份队列、线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。可以简单地说，**服务雪崩就是一个或多个服务故障引起相关依赖的服务的级联故障。**

解决的方式就是：弃车保帅。

### 什么是Hystrix

Hystrix是一个分布式系统的延迟和容错的开源库，在分布式系统中许多依赖不可避免的会调用失败，比如超时，异常等。Hystrix能够保证一个依赖在出问题的情况下，不会导致整体服务失败，避免级联故障，以提高系统的可用性。

Hystrix又称断路器，本身是一个开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝），向调用方返回一个服务预期的，可处理的备选响应（FallBack），而不是长时间等待或者抛出调用方无法处理的异常，这样就可以保证调用方的线程不会被长时间，不必要的占用，从而避免故障在分布式系统中蔓延，乃至雪崩。

### Hystrix的功能作用

- 服务降级
- 服务熔断
- 服务限流
- 接近实时的监控

### 服务熔断

熔断机制是对雪崩机制的一种微服务链路保护机制。

当扇出链路的某个微服务不可用或响应时间太长，会进行服务的降级，进而==熔断该节点微服务的调用，快速返回或者返回错误的响应信息==。当检测到该节点微服务调用响应正常后恢复调用链路。在SpringCloud框架里熔断机制通过Hystrix实现。Hystrix会监控微服务之间调用的情况。当失败的调用到一定的阈值，缺省是5秒20次调用失败就会启动熔断机制。熔断机制的注解是@HystrixCommand。









